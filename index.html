<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2f3549">
    <title>ILLUSION's SVS Prep Booking System - Whiteout Survival</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1d29 0%, #252b3d 25%, #2f3549 50%, #252b3d 75%, #1a1d29 100%);
            min-height: 100vh;
            color: #ffffff;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(74, 144, 226, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(91, 160, 242, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255,255,255,0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            background: linear-gradient(135deg, rgba(47, 53, 73, 0.8), rgba(37, 43, 61, 0.9));
            border-radius: 15px;
            padding: 15px;
            /* backdrop-filter: blur(10px); */
            border: 1px solid rgba(74, 144, 226, 0.3);
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            overflow: hidden;
        }

        .header-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 20px auto;
            border: 3px solid rgba(74, 144, 226, 0.5);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f0f0f0, #e8e8e8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #666;
        }

        .header-logo:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
            border-color: rgba(74, 144, 226, 0.7);
        }

        .header-logo img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(135deg, #ffffff, #4a90e2, #5ba0f2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 0.9rem;
            opacity: 0.9;
            color: #a8b4c7;
        }

        .tabs-container {
            background: linear-gradient(135deg, rgba(47, 53, 73, 0.7), rgba(37, 43, 61, 0.8));
            border-radius: 15px;
            padding: 20px;
            /* backdrop-filter: blur(15px); */
            border: 1px solid rgba(74, 144, 226, 0.25);
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 25px;
            border-bottom: 2px solid rgba(74, 144, 226, 0.3);
            padding-bottom: 15px;
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 12px 8px;
            text-align: center;
            background: linear-gradient(135deg, rgba(47, 53, 73, 0.6), rgba(37, 43, 61, 0.7));
            border: 1px solid rgba(74, 144, 226, 0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #a8b4c7;
        }

        .tab:hover {
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.2), rgba(91, 160, 242, 0.3));
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.4);
            color: #ffffff;
        }

        .tab.active {
            background: linear-gradient(135deg, #4a90e2, #5ba0f2);
            color: white;
            box-shadow: 0 4px 15px rgba(74,144,226,0.4);
            border-color: #4a90e2;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .time-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .time-slot {
            background: linear-gradient(135deg, rgba(47, 53, 73, 0.5), rgba(37, 43, 61, 0.6));
            border: 2px solid rgba(74, 144, 226, 0.3);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            /* backdrop-filter: blur(5px); */
            position: relative;
        }

        .time-slot:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(74, 144, 226, 0.3);
        }

        .time-slot.available {
            border-color: rgba(46, 204, 113, 0.6);
        }

        .time-slot.available:hover {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.2), rgba(46, 204, 113, 0.3));
            border-color: #2ecc71;
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.4);
        }

        .time-slot.reserved {
            border-color: rgba(231, 76, 60, 0.6);
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.15), rgba(231, 76, 60, 0.2));
        }

        .time-slot.reserved:hover {
            border-color: #e74c3c;
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
        }

        .time-label {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: #ffffff;
        }

        .member-info {
            font-size: 0.9rem;
            opacity: 0.8;
            color: #a8b4c7;
        }

        .status-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-available {
            background: rgba(46, 204, 113, 0.3);
            color: #2ecc71;
            border: 1px solid rgba(46, 204, 113, 0.5);
        }

        .status-reserved {
            background: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.5);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #252b3d, #2f3549);
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            border: 1px solid rgba(74, 144, 226, 0.3);
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
            position: relative;
        }

        .modal h2 {
            margin-bottom: 20px;
            color: #ffffff;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #a8b4c7;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(74, 144, 226, 0.3);
            border-radius: 8px;
            background: rgba(47, 53, 73, 0.5);
            color: #ffffff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4a90e2;
            background: rgba(47, 53, 73, 0.7);
            box-shadow: 0 0 0 3px rgba(74,144,226,0.2);
        }

        .form-group input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4a90e2, #5ba0f2);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #357abd, #4a90e2);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(74,144,226,0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(231,76,60,0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, rgba(47, 53, 73, 0.8), rgba(37, 43, 61, 0.9));
            color: #ffffff;
            border: 1px solid rgba(74, 144, 226, 0.4);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.3), rgba(91, 160, 242, 0.4));
            transform: translateY(-2px);
        }

        .close {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #a8b4c7;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #ffffff;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .tabs {
                justify-content: center;
            }

            .tab {
                flex: none;
                min-width: 100px;
                font-size: 0.9rem;
                padding: 10px 6px;
            }

            .time-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 5% auto;
                padding: 20px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .tabs-container {
                padding: 15px;
            }

            .tabs {
                gap: 8px;
                flex-direction: column;
            }

            .tab {
                min-width: unset;
                width: 100%;
            }
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #a8b4c7;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid;
        }

        .legend-available .legend-color {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }

        .legend-reserved .legend-color {
            background: rgba(231, 76, 60, 0.3);
            border-color: #e74c3c;
        }        
    </style>
<style name="nordpass-fonts">@font-face { font-family: "Roboto Mono"; font-style: normal; font-weight: 500; src: url("chrome-extension://eiaeiblijfjekdanodkjadfinkhbfgcd/css/../assets/RobotoMono-Medium.ttf") format("truetype"); }@font-face { font-family: "Roboto Mono"; font-style: normal; font-weight: 700; src: url("chrome-extension://eiaeiblijfjekdanodkjadfinkhbfgcd/css/../assets/RobotoMono-Bold.ttf") format("truetype"); }@font-face { font-family: Inter; font-style: normal; font-weight: 400; src: url("chrome-extension://eiaeiblijfjekdanodkjadfinkhbfgcd/css/../assets/Inter-Regular.ttf") format("truetype"); }@font-face { font-family: Inter; font-style: normal; font-weight: 500; src: url("chrome-extension://eiaeiblijfjekdanodkjadfinkhbfgcd/css/../assets/Inter-Medium.ttf") format("truetype"); }@font-face { font-family: Inter; font-style: normal; font-weight: 600; src: url("chrome-extension://eiaeiblijfjekdanodkjadfinkhbfgcd/css/../assets/Inter-SemiBold.ttf") format("truetype"); }@font-face { font-family: Inter; font-style: normal; font-weight: 700; src: url("chrome-extension://eiaeiblijfjekdanodkjadfinkhbfgcd/css/../assets/Inter-Bold.ttf") format("truetype"); }</style></head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-logo">
                <img src="./illusion.jpg" alt="Illusion Logo">
            </div>
            <h1>SVS Prep Booking System</h1>
<p>[OMG]3043: ‚òï If this booking system makes SVS easier for you, please consider buying me a coffee ‚Äì hop on Midasbuy and send a few Frost Stars my way (Player ID: <strong>491298360</strong>). ‚ùÑÔ∏è Every bit of spare change helps and keeps this tool alive! üíô</p>
        </div>

        <div class="tabs-container" id="tabs-container">

            <div class="tabs" id="tabs"><div class="tab active" data-id="buff-1">Monday (Construction)</div><div class="tab" data-id="buff-2">Tuesday (Tech Buff)</div><div class="tab" data-id="buff-4">Thursday (Troop Training)</div></div>

            <div class="legend" id="legend" style="display: flex;">
                <div class="legend-item legend-available">
                    <div class="legend-color"></div>
                    <span id="legend-available-text">34 Available</span>
                </div>
                <div class="legend-item legend-reserved">
                    <div class="legend-color"></div>
                    <span id="legend-reserved-text">14 Reserved</span>
                </div>
            </div>

            <div class="tab-content active" id="tab-content">
                <div class="time-grid" id="time-grid"></div>
            </div>

        </div>
    </div>

    <!-- Booking Modal -->
    <div id="bookingModal" class="modal" style="display: none;">
        <div class="modal-content" data-np-autofill-form-type="register" data-np-checked="1" data-np-watching="1">
            <span class="close">√ó</span>
            <h2>üè∞ Book Time Slot</h2>
            <div id="bookingModal-note" class="form-group" style="border: 1px solid rgb(231, 76, 60); padding: 10px; border-radius: 8px; background: rgba(231, 76, 60, 0.1); margin-bottom: 20px; display: none;">
                <div id="bookingModal-note-body">‚ÄºÔ∏è You must have at least 300 hours of speedups to book a spot.</div>
            </div>
            <div class="form-group">
                <label for="allianceName">Alliance Name:</label>
                <input type="text" id="allianceName" placeholder="Enter your Alliance name" required="" data-np-autofill-field-type="fullName">
            </div>
            <div class="form-group">
                <label for="playerName">Player Name:</label>
                <input type="text" id="playerName" placeholder="Enter your Player name" required="" data-np-autofill-field-type="fullName">
            </div>
            <div class="form-group">
                <label for="bookingPassword">Cancellation Password:</label>
                <input type="password" id="bookingPassword" placeholder="Set a password to cancel this booking later" required="" data-np-autofill-field-type="newPassword">
                <small style="color: #a8b4c7; font-size: 0.8rem; display: block; margin-top: 5px;">
                    ‚ö†Ô∏è Remember this password - you'll need it to cancel your booking
                </small>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="confirmBooking()">Confirm Booking</button>
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Cancel Booking Modal -->
    <div id="cancelModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">√ó</span>
            <h2>üîí Cancel Booking</h2>
            <p style="text-align: center; margin-bottom: 20px; color: #a8b4c7;">Enter the password you set when booking this slot:</p>
            <div class="form-group">
                <label for="cancelPassword">Cancellation Password:</label>
                <input type="password" id="cancelPassword" placeholder="Enter your cancellation password" required="">
            </div>
            <div class="button-group">
                <button class="btn btn-danger" onclick="confirmCancellation()">Cancel Booking</button>
                <button class="btn btn-secondary" onclick="closeModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Result Modal -->
    <div id="resultModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <span class="close">√ó</span>
            <div id="resultContent" style="text-align: center; padding: 20px 0;">
                <!-- Result content will be inserted here -->
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="closeResultModal()">OK</button>
            </div>
        </div>
    </div>

    <script>

        let currentBuffId = null;
        let currentSlotId = null;
        let currentTime = null;

        function getEndTime(startTime) {
            const [hour, minute] = startTime.split(':').map(Number);
            let endHour = hour;
            let endMinute = minute + 30;
            
            if (endMinute >= 60) {
                endHour += 1;
                endMinute = 0;
            }
            if (endHour >= 24) {
                endHour = 0;
            }
            
            return String(endHour).padStart(2, '0') + ':' + String(endMinute).padStart(2, '0');
        }

        function confirmBooking() {
            const allianceName = document.getElementById('allianceName').value.trim();
            const playerName = document.getElementById('playerName').value.trim();
            const password = document.getElementById('bookingPassword').value;

            const buffId = currentBuffId;
            const slotId = currentSlotId;
            const time = currentTime;
            
            if (!allianceName || !playerName || !password) {
                showResultDialog('error', '‚ùå Validation Error', 'Please fill in all fields including the cancellation password');
                return;
            }
            
            if (password.length < 4) {
                showResultDialog('error', '‚ùå Password Too Short', 'Password must be at least 4 characters long');
                return;
            }

            let buffName = document.querySelector(`.tab.active`).innerText;

            // call api
            fetch(`${baseUrl}/slots`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    PK: buffId,
                    SK: slotId,
                    Alliance: allianceName,
                    Name: playerName,
                    Password: password
                })
            }).then(response => response.json()).then(data => {
                if (data == 'OK') {
                    showResultDialog('success', '‚úÖ Booking Confirmed!', 
                        `Your time slot has been successfully booked!<br><br>
                        <strong>üìÖ Day:</strong> ${buffName}<br>
                        <strong>‚è∞ Time:</strong> ${currentTime} - ${getEndTime(currentTime)} UTC<br>
                        <strong>üè∞ Alliance:</strong> ${allianceName}<br>
                        <strong>üë§ Player:</strong> ${playerName}<br><br>
                        üîê <em>Your cancellation password has been set. Keep it safe!</em>`);
                    closeModal();

                    // refresh slot list
                    loadSlotList(buffId);
                } else {
                    showResultDialog('error', '‚ùå Booking Failed', data);
                }
            }).catch(error => {
                console.log('Error booking slot:', error);
                showResultDialog('error', '‚ùå Booking Failed', error);
                return;
            });            

        }

        function confirmCancellation() {
            const enteredPassword = document.getElementById('cancelPassword').value;

            if (enteredPassword == '') {
                showResultDialog('error', '‚ùå Incorrect Password', 'Please enter the cancellation password.');
                return;
            }

            const buffId = currentBuffId;
            const slotId = currentSlotId;
            const time = currentTime;

            // call api
            fetch(`${baseUrl}/slots/${buffId}/${slotId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    Password: enteredPassword
                })
            }).then(response => response.json()).then(data => {
                if (data == 'OK') {
                    showResultDialog('success', '‚úÖ Booking Cancelled', 'Your booking has been successfully cancelled.');
                    document.getElementById('cancelPassword').value = '';
                    closeModal();

                    // refresh slot list
                    loadSlotList(buffId);
                } else {
                    showResultDialog('error', '‚ùå Cancellation Failed', data);
                }
            }).catch(error => {
                console.log('Error cancelling booking:', error);
                showResultDialog('error', '‚ùå Cancellation Failed', error);
                return;
            });
        }

        function closeModal() {
            document.getElementById('bookingModal').style.display = 'none';
            document.getElementById('cancelModal').style.display = 'none';
        }

        function closeResultModal() {
            document.getElementById('resultModal').style.display = 'none';
        }

        function showResultDialog(type, title, message) {
            const resultContent = document.getElementById('resultContent');
            
            if (type === 'success') {
                resultContent.innerHTML = `
                    <div style="color: #2ecc71; font-size: 3rem; margin-bottom: 15px;">‚úÖ</div>
                    <h2 style="color: #2ecc71; margin-bottom: 20px;">${title}</h2>
                    <div style="color: #a8b4c7; line-height: 1.6; font-size: 0.95rem;">${message}</div>
                `;
            } else if (type === 'error') {
                resultContent.innerHTML = `
                    <div style="color: #e74c3c; font-size: 3rem; margin-bottom: 15px;">‚ùå</div>
                    <h2 style="color: #e74c3c; margin-bottom: 20px;">${title}</h2>
                    <div style="color: #a8b4c7; line-height: 1.6; font-size: 0.95rem;">${message}</div>
                `;
            }
            
            document.getElementById('resultModal').style.display = 'block';
        }


        // Close modal when clicking the X or outside the modal
        document.querySelectorAll('.close').forEach(close => {
            close.addEventListener('click', (e) => {
                const modal = e.target.closest('.modal');
                if (modal) {
                    modal.style.display = 'none';
                }
            });
        });

        window.addEventListener('click', (event) => {
            const bookingModal = document.getElementById('bookingModal');
            const cancelModal = document.getElementById('cancelModal');
            const resultModal = document.getElementById('resultModal');
            
            if (event.target === bookingModal) {
                bookingModal.style.display = 'none';
            } else if (event.target === cancelModal) {
                cancelModal.style.display = 'none';
            } else if (event.target === resultModal) {
                resultModal.style.display = 'none';
            }
        });

        // Handle Enter key in forms
        document.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                if (document.getElementById('bookingModal').style.display === 'block') {
                    confirmBooking();
                } else if (document.getElementById('cancelModal').style.display === 'block') {
                    confirmCancellation();
                } else if (document.getElementById('resultModal').style.display === 'block') {
                    closeResultModal();
                }
            }
        });


        const baseUrl = 'https://three043wos.onrender.com';
        const buffMap = {};

        function loadBuffList() {
            tabs.innerHTML = '<div style="width: 100%; text-align: center;">Loading...</div>';
            fetch(`${baseUrl}/buffs`)
                .then(response => response.json())
                .then(data => {
                    let buffs = data;

                    console.log("buffs loaded:", buffs);
                    
                    let tabs = document.getElementById("tabs");
                    // delete current tabs
                    tabs.innerHTML = "";
                    // create new tabs
                    buffs.forEach(buff => {
                        let tab = document.createElement("div");
                        tab.classList.add("tab");
                        tab.innerText = buff.Name;
                        tab.dataset.id = buff.PK;

                        tab.addEventListener("click", () => onTabClick(tab));
                        tabs.appendChild(tab);

                        buffMap[buff.PK] = buff;
                    });

                    // click the first tab
                    if (buffs.length > 0) {
                        tabs.firstChild.click();
                    }
                })
                .catch(error => {
                    console.error("Error loading data:", error);
                });
        }

        function loadSlotList(buffId) {

            let grid = document.getElementById("time-grid");

            // prepare grid
            fetch(`${baseUrl}/slots/${buffId}`)
            .then(response => response.json())
            .then(data => {
                console.log("slots loaded:", data);

                // check if tab is still active
                if (document.querySelector(`.tab.active`)?.dataset.id !== buffId) {
                    console.log("Tab is no longer active");
                    return;
                }

                let slots = data;

                grid.innerHTML = ""; // Clear previous slots

                let availableCount = 0;
                let reservedCount = 0;

                // generate grid
                for (let hour = 0; hour < 24; hour++) {
                    for (let minute = 0; minute < 60; minute += 30) {
                        const timeStr = String(hour).padStart(2, '0') + ':' + String(minute).padStart(2, '0');
                        const slotId = `slot-${timeStr.replace(':', '')}`;

                        const booking = slots.find(s => s.SK === slotId);

                        const slot = document.createElement('div');
                        slot.className = `time-slot ${booking ? 'reserved' : 'available'}`;
                        slot.dataset.time = timeStr;
                        slot.dataset.buffId = buffId;
                        slot.dataset.slotId = slotId;
                        slot.dataset.alliance = booking ? booking.Alliance : '';
                        slot.dataset.name = booking ? booking.Name : '';

                        const statusBadge = document.createElement('div');
                        statusBadge.className = `status-badge ${booking ? 'status-reserved' : 'status-available'}`;
                        statusBadge.textContent = booking ? 'Reserved' : 'Available';

                        if (booking) {
                            reservedCount++;
                        } else {
                            availableCount++;
                        }
                        
                        const timeLabel = document.createElement('div');
                        timeLabel.className = 'time-label';
                        timeLabel.textContent = `${timeStr} - ${getEndTime(timeStr)} UTC`;
                        
                        const memberInfo = document.createElement('div');
                        memberInfo.className = 'member-info';
                        memberInfo.textContent = booking 
                            ? `[${booking.Alliance}]${booking.Name}`
                            : 'Click to book this slot';
                        
                        slot.appendChild(statusBadge);
                        slot.appendChild(timeLabel);
                        slot.appendChild(memberInfo);

                        slot.addEventListener('click', () => onSlotClick(slot));
                        grid.appendChild(slot);
                    }
                }
                
            document.getElementById('legend-available-text').innerText = `${availableCount} Available`;
            document.getElementById('legend-reserved-text').innerText = `${reservedCount} Reserved`;

                document.getElementById('legend').style.display = 'flex';

            })
            .catch(error => {
                console.error("Error loading data:", error);
                grid.innerHTML = error;
            });
        }

        function onTabClick(tab) {

            const buffId = tab.dataset.id;
            console.log("Tab clicked:", buffId);
            // You can add more logic here to handle the tab click

            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            
            // Add active class to clicked tab
            tab.classList.add('active');

            let grid = document.getElementById("time-grid");

            grid.innerHTML = '<div style="text-align: center;">Loading...</div>';

            document.getElementById('legend').style.display = 'none';

            loadSlotList(buffId);
        }

        function onSlotClick(slot) {

            const buffId = slot.dataset.buffId;
            const slotId = slot.dataset.slotId;
            const time = slot.dataset.time;

            console.log('slot clicked', buffId, slotId, time);

            currentBuffId = buffId;
            currentSlotId = slotId
            currentTime = time;

            let buff = buffMap[buffId];
            let note = buff ? buff.Note : '';

            if (note && note.trim() !== '') {
                document.getElementById('bookingModal-note-body').innerText = note;
                document.getElementById('bookingModal-note').style.display = 'block';
            } else {
                document.getElementById('bookingModal-note').style.display = 'none';
            }

            const isBooked = slot.classList.contains('reserved');

            if (isBooked) {
                document.getElementById('cancelModal').style.display = 'block';
            } else {
                document.getElementById('bookingModal').style.display = 'block';
            }
        }

        // call function loadData after document loaded
        document.addEventListener("DOMContentLoaded", loadBuffList);
        

    </script>

</body></html>